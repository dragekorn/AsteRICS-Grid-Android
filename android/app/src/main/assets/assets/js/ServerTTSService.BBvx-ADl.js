var e=Object.defineProperty;import{T as t,p as i,n as r,c as s}from"./index.Ba1ewq7F.js";const a=s("ServerTTSService");class n extends t{constructor(){var t;super(...arguments),((t,i,r)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r})(this,"symbol"!=typeof(t="serverAvailable")?t+"":t,!1)}async initialize(){i.mark("server-tts-init-start");try{const e=r.healthCheck(),t=new Promise((e,t)=>{setTimeout(()=>t(new Error("Health check timeout")),3e3)}),s=await Promise.race([e,t]);this.serverAvailable="ok"===s.status,this.isInitialized=!0,i.measure("server-tts-init","server-tts-init-start"),a.info("Server TTS initialized",{serverAvailable:this.serverAvailable,model:s.model})}catch(e){throw a.error("Failed to initialize Server TTS",e),e}}async synthesize(e){if(this.ensureInitialized(),!this.serverAvailable)throw new Error("Server is not available");const t=this.generateRequestId();i.mark(`server-tts-synth-${t}`);try{const s=this.validateOptions(e);a.debug("Synthesizing via server",{requestId:t,text:s.text});const n=s.text.split(/\s+/).filter(e=>e.length>0),l=await r.generateSpeech(n),o=i.measure(`server-tts-synth-${t}`,`server-tts-synth-${t}`),u={requestId:t,audioData:l,duration:this.estimateDuration(l),sampleRate:22050,channels:1,synthesisTime:o};return a.info("Server synthesis completed",{requestId:t,duration:u.duration,synthesisTime:u.synthesisTime}),u}catch(s){throw a.error("Server synthesis failed",s),s}}async getAvailableVoices(){return[{id:"ru_RU-irina-medium",name:"Ирина (средний)",language:"ru-RU",gender:"female",sampleRate:22050,modelSize:29360128,quality:"medium",loaded:this.serverAvailable}]}getStatus(){return{initialized:this.isInitialized,activeRequests:0,queuedRequests:0,availableVoices:["ru_RU-irina-medium"],memoryUsage:0,lastError:null}}async cleanup(){this.stop(),this.isInitialized=!1,this.serverAvailable=!1,a.info("Server TTS cleaned up")}estimateDuration(e){return(e.byteLength-44)/44100}}export{n as ServerTTSService};
