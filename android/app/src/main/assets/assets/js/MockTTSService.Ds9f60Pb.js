var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{T as s,p as i,c as a}from"./index.Ba1ewq7F.js";const n=a("MockTTSService");class r extends s{constructor(){super(...arguments),t(this,"synth",null),t(this,"availableVoices",[]),t(this,"activeRequests",0),t(this,"queuedRequests",0)}async initialize(){i.mark("tts-init-start");try{if(!("speechSynthesis"in window))throw new Error("Web Speech API not supported in this browser");this.synth=window.speechSynthesis,await this.loadVoices(),this.isInitialized=!0,i.measure("tts-init","tts-init-start"),n.info("Mock TTS service initialized",{voiceCount:this.availableVoices.length})}catch(e){throw n.error("Failed to initialize Mock TTS service",e),e}}async synthesize(e){this.ensureInitialized();const t=this.generateRequestId();i.mark(`tts-synthesis-start-${t}`),this.activeRequests++;try{const s=this.validateOptions(e);n.debug("Synthesizing text",{requestId:t,textLength:s.text.length,voice:s.voice});const a=await this.generateMockAudio(s),r=i.measure(`tts-synthesis-${t}`,`tts-synthesis-start-${t}`),l={requestId:t,audioData:a,duration:this.estimateDuration(s.text),sampleRate:22050,channels:1,synthesisTime:r};return n.info("Synthesis completed",{requestId:t,duration:l.duration,synthesisTime:l.synthesisTime}),l}catch(s){throw n.error("Synthesis failed",s),{code:"SYNTHESIS_FAILED",message:s instanceof Error?s.message:String(s),requestId:t,timestamp:Date.now(),details:s}}finally{this.activeRequests--,i.clearMark(`tts-synthesis-start-${t}`)}}async getAvailableVoices(){return this.ensureInitialized(),0===this.availableVoices.length&&await this.loadVoices(),Object.freeze([...this.availableVoices])}getStatus(){return{initialized:this.isInitialized,activeRequests:this.activeRequests,queuedRequests:this.queuedRequests,availableVoices:this.availableVoices.map(e=>e.id),memoryUsage:this.estimateMemoryUsage(),lastError:null}}async cleanup(){null!==this.synth&&(this.synth.cancel(),this.synth=null),this.stop(),this.isInitialized=!1,this.availableVoices=[],n.info("Mock TTS service cleaned up")}loadVoices(){return new Promise(e=>{if(null===this.synth)return void e();const t=()=>{const t=this.synth.getVoices();if(this.availableVoices=t.map((e,t)=>({id:`mock_${t}`,name:e.name,language:e.lang,gender:this.guessGender(e.name),sampleRate:22050,modelSize:0,quality:"medium",loaded:!0})),null===this.currentVoice&&this.availableVoices.length>0){const e=this.availableVoices.find(e=>e.language.startsWith("en"));this.currentVoice=e?.id??this.availableVoices[0].id}e()};this.synth.getVoices().length>0?t():(this.synth.onvoiceschanged=()=>{t()},setTimeout(()=>{0===this.availableVoices.length&&t()},1e3))})}async generateMockAudio(e){const t=22050,s=this.estimateDuration(e.text),i=Math.floor(t*s),a=new Float32Array(i);for(let n=0;n<i;n++)a[n]=.3*Math.sin(2*Math.PI*440*n/t);return this.encodeWAV(a,t)}encodeWAV(e,t){const s=new ArrayBuffer(44+2*e.length),i=new DataView(s),a=(e,t)=>{for(let s=0;s<t.length;s++)i.setUint8(e+s,t.charCodeAt(s))};a(0,"RIFF"),i.setUint32(4,36+2*e.length,!0),a(8,"WAVE"),a(12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,1,!0),i.setUint32(24,t,!0),i.setUint32(28,2*t,!0),i.setUint16(32,2,!0),i.setUint16(34,16,!0),a(36,"data"),i.setUint32(40,2*e.length,!0);let n=44;for(let r=0;r<e.length;r++){const t=Math.max(-1,Math.min(1,e[r]));i.setInt16(n,t<0?32768*t:32767*t,!0),n+=2}return s}estimateDuration(e){return e.split(/\s+/).length/150*60}estimateMemoryUsage(){return 1048576+524288*this.activeRequests}guessGender(e){const t=e.toLowerCase();return t.includes("female")||t.includes("woman")||t.includes("zira")||t.includes("samantha")?"female":t.includes("male")||t.includes("man")||t.includes("david")||t.includes("alex")?"male":"neutral"}}export{r as MockTTSService};
